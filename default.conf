upstream webcluster {
    server web008 weight=5 max_fails=0;
}

upstream partner {
    server web001 weight=3 max_fails=0;
    server web002 weight=1 max_fails=0;
}

upstream apicluster {
#    server web006 weight=5 max_fails=0;
    server web010 weight=6 max_fails=0;
    server web012 weight=6 max_fails=0;
}
upstream facluster {
    server web010 weight=6 max_fails=0;
    server web012 weight=6 max_fails=0;
}

upstream quotascluster {
    server quota:80 weight=5 max_fails=0;
    #server quota:3000 weight=5 max_fails=0;
    #server quota:30001 weight=5 max_fails=0;
}

upstream mobilecluster {
    #server  storage.eztable.com:32073 weight=4 max_fails=0;
    #server  nodejs.eztable.com:32073 weight=2 max_fails=0;
    server  mobile3:32073 weight=6 max_fails=0;
}


# eztable-ssl - this should be the first to support ip address
server {
    listen       80;
    server_name  ssl.eztable.com;
    return       301 https://ssl.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  ssl.eztable.com;
    #server_name  ssl.eztable.com ssl-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/ssl.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-ssl/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-ssl/$1;
        expires 1d;
    }

    # project ssl/protected
    #location ~ ^/protected/(.*)?$  {
    #    limit_req zone=site burst=880;
    #    include proxy.conf;
    #    proxy_pass      http://web007.eztable.com/protected/$1;
    #}

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

server {
    listen       80;
    server_name  secure.eztable.com;
    return       301 https://secure.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  secure.eztable.com;
    #server_name  secure.eztable.com secure-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/secure.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-secure/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-secure/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}


# ambassador
server {
    listen       80;
    server_name  ambassador.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=ambassador-kaohsiung;
}

server {
    listen       80;
    server_name  ambassadori-k.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=ambassador-kaohsiung;
}

server {
    listen       80;
    server_name  ambassador-m.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=ambassador-kaohsiung;
}

server {
    listen       80;
    server_name  ambassador-c.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=ambassador-kaohsiung;
}

# hitobbq
server {
    listen       80;
    server_name  www.hitobbq.com;
    return       301 http://www.eztable.com/search.php?keyword=田季;
}

server {
    listen       80;
    server_name  hitobbq.com;
    return       301 http://www.eztable.com/search.php?keyword=田季;
}

server {
    listen       80;
    server_name  hito-bbq.com;
    return       301 http://www.eztable.com/search.php?keyword=田季;
}

server {
    listen       80;
    server_name  www.hito-bbq.com;
    return       301 http://www.eztable.com/search.php?keyword=田季;
}

# landishotelsresorts
server {
    listen       80;
    server_name  booking.landishotelsresorts.com;
    return       301 http://partner.eztable.com/booking.php?page_name=landis;
}

# landis-api
server {
    listen       80;
    listen       443 ssl;
    server_name  landis-api.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    keepalive_timeout 15;

    access_log   /var/log/nginx/landis-api.eztable.com.access.log  main;

    return       301 http://www.landishotelsresorts.com/chinese-trad/;

    # project php
    #location / {
    #    limit_req zone=site burst=8;
    #    include proxy.conf;
    #    proxy_pass      http://job001;
    #}
}

# sheraton
server {
    listen       80;
    server_name  sheraton-english.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=sheraton&locale=en_US;
}

server {
    listen       80;
    server_name  sheraton-japanese.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=sheraton&locale=ja_JP;
}

server {
    listen       80;
    server_name  sheraton-simplified.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=sheraton&locale=zh_CN;
}

server {
    listen       80;
    server_name  sheraton.eztable.com.tw;
    return       301 http://partner.eztable.com/booking.php?page_name=sheraton;
}

# android-shopping
server {
    listen       80;
    server_name  android-shopping.eztable.com;
    return       301 https://play.google.com/store/apps/details?id=com.eztable.shareshopping;
}

# eztable-api
server {
    listen       80;
    listen       443 ssl;
    #listen       443 spdy ssl;
    server_name  api.eztable.com;
    #server_name  api.eztable.com api-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    keepalive_timeout 15;

    access_log   /var/log/nginx/api.eztable.com.access.log  main;

    client_max_body_size 8M;

    # for query
    location ~ ^/v3/restaurants/quotas?(.*)$ {
        try_files $uri @redirecrc;
    }

    location @redirecrc {
        include proxy.conf;
        proxy_pass http://quotascluster/?$args;
    }

    # for 智付寶
    location ~ ^/v3/orders/(.+)/payment(.*)$ {
        include proxy.conf;
        proxy_pass http://facluster;
    }
    location ~ ^/v3/admin/invoice(.*)$ {
        include proxy.conf;
        proxy_pass  http://facluster;
    }

    location ~ ^/v2/reservation/get_info/(.*)$ {
        return 404;
    }

    # project php
    location / {
        #limit_req zone=site burst=500 nodelay;
        include proxy.conf;
        proxy_pass      http://apicluster/;
    }
}

# eztable-bellavita
server {
    listen       80;
    server_name  bellavita.eztable.com.tw;
    access_log   /var/log/nginx/bellavita.eztable.com.tw.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-bellavita/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-bellavita/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-birthday
server {
    listen       80;
    server_name  birthday.eztable.com.tw;
    return       301 http://birthday.eztable.com$request_uri;
}

server {
    listen       80;
    listen       443 ssl;
    server_name  birthday.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/birthday.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-birthday/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-birthday/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-cdn
server {
    listen       80;
    server_name  static-host.eztable.com;
    access_log   /var/log/nginx/static-host.eztable.com.access.log  main;

    # general imgs
    location ~ ^/imgs/(.*)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-imgs/$1;
        expires 30d;
    }

    # all other files
    location ~ ^/(.*)$ {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-cdn/$1;
        expires 30d;
    }
}

# eztable-facebook
server {
    listen       80;
    listen       443 ssl;
    server_name  facebook.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;
    access_log   /var/log/nginx/facebook.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-facebook/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-facebook/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-feeds
server {
    listen       80;
    listen       443 ssl;
    server_name  feeds.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/feeds.eztable.com.access.log  main;

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-ideas
server {
    listen       80;
    server_name  blog.eztable.com.tw;
    return       301 http://blog.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  blog.eztable.com;
    access_log   /var/log/nginx/blog.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://blog.eztable.com.tw;
    }
}

# eztable-img-dev
server {
    listen       80;
    listen       443 ssl;
    server_name  img-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/img-dev.eztable.com.access.log  main;

    client_max_body_size 8M;

    location / {
        proxy_pass http://eztable-image-dev.s3-website-us-east-1.amazonaws.com;
        expires 30d;
    }
}

# eztable-img
server {
    listen       80;
    listen       443 ssl;
    server_name  img.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/img.eztable.com.access.log  main;

    client_max_body_size 8M;

    location / {
        proxy_pass http://eztable-image.s3-website-us-east-1.amazonaws.com;
        expires 30d;
    }
}

# eztable-img
server {
    listen       80;
    listen       443 ssl;
    server_name  images-static.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/images-static.eztable.com.access.log  main;

    client_max_body_size 8M;

    location / {
        proxy_pass http://web007.eztable.com;
        expires 30d;
    }
}

# eztable-ipadconsole
server {
    listen       80;
    server_name  ipadconsole.eztable.com;
    return       301 https://ipadconsole.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  ipadconsole.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/ipadconsole.eztable.com.access.log  main;

    # api
    location ~ ^/v2/(.*)$ {
        include proxy-api.conf;
        proxy_pass      http://webcluster;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-ipadconsole/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-ipadconsole/$1;
        expires 1h;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-mobile
server {
    listen       80;
    listen       443 ssl;
    server_name  m.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/m.eztable.com.access.log  main;

    rewrite ^/search/? https://tw.eztable.com/search permanent;
    rewrite ^/login/? https://tw.eztable.com/member permanent;
    rewrite ^/member/reservations/? https://tw.eztable.com/member/reservations permanent;
    rewrite ^/member/point/? https://tw.eztable.com/member/ezcash permanent;
    rewrite ^/member/vouchers/? https://tw.eztable.com/member/purchase permanent;
    rewrite ^/member/? https://tw.eztable.com/member permanent;

    rewrite ^/product/([^/]+)/([0-9]+) https://tw.eztable.com/product/$1/$2 permanent;
    rewrite ^/brandrestaurant/([^/]+)/([0-9]+) https://tw.eztable.com/product/$1/$2 permanent;

    rewrite ^/restaurant/([0-9]+) https://tw.eztable.com/restaurant/$1 permanent;
    rewrite ^/reservation/([0-9]+) https://tw.eztable.com/reservation/$1 permanent;
    rewrite ^/purchase/([0-9]+) https://tw.eztable.com/member/purchase/$1 permanent;

    rewrite ^ https://tw.eztable.com/ permanent;

}


# webView
server {
    listen       80;
    listen       443 ssl;
    server_name  webview.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/webview.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# console.eztable.com
server {
    listen       80;
    listen       443 ssl;
    server_name  console.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/console.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://nodejs.eztable.com:32093;
    }
}

# eztableMobile3
server {
    listen       80;
    server_name  tw.eztable.com;
    return       301 https://tw.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  en.eztable.com;
    return       301 https://en.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  th.eztable.com;
    return       301 https://th.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  id.eztable.com;
    return       301 https://id.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  wv.eztable.com;
    return       301 https://wv.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  hk.eztable.com;
    return       301 https://hk.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  restaurant.eztable.com;
    return       301 https://restaurant.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  tw.eztable.com en.eztable.com th.eztable.com id.eztable.com wv.eztable.com hk.eztable.com restaurant.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/mobile3.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        #proxy_pass      http://storage.eztable.com:32073;
        proxy_pass      http://mobilecluster;
    }
}

# GCE images
server {
    listen       80;
    server_name  pic-bed.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/gceimages.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://107.167.177.219:8888;
    }
}

# restaurant-support-center
server {
    listen       80;
    server_name  support.eztable.com;
    return       301 https://support.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  support.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/support.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://nodejs.eztable.com:31977;
    }
}

# codepush
server {
    listen       80;
    listen       443 ssl;
    server_name  codepush.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/codepush.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://storage.eztable.com:8420;
    }
}

# luffy
server {
    listen       80;
    listen       443 ssl;
    server_name  reporter.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/reporter.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://10.166.135.182:5000;
    }
}

# eztable-news
server {
    listen       80;
    server_name  news.eztable.com.tw;
    return       301 http://news.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  news.eztable.com;
    access_log   /var/log/nginx/news.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://news.eztable.com.tw;
    }
}

# eztable-pcconsole
server {
    listen       80;
    server_name  pcconsole.eztable.com;
    return       301 https://pcconsole.eztable.com$request_uri;
}

#server {
#    listen       80;
#    server_name  pcconsole-dev.eztable.com;
#    return       301 https://pcconsole-dev.eztable.com$request_uri;
#}

server {
    listen       443 ssl;
    server_name  pcconsole.eztable.com;
    #server_name  pcconsole.eztable.com pcconsole-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/pcconsole.eztable.com.access.log  main;

    # api
    location ~ ^/v2/(.*)$ {
        include proxy-api.conf;
        proxy_pass      http://webcluster;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        #limit_req zone=static burst=880;
        #include proxy.conf;
        #proxy_pass      http://web001:3939/eztable-pcconsole/$1;
        proxy_pass      http://web007.eztable.com/eztable-pcconsole/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        #limit_req zone=static burst=880;
        #include proxy.conf;
        #proxy_pass      http://web001:3939/eztable-pcconsole/$1;
        proxy_pass      http://web007.eztable.com/eztable-pcconsole/$1;
        expires 1h;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        #proxy_pass      http://web001;
        proxy_pass      http://web007;
    }
}

# eztable-production
server {
    listen       80;
    server_name  pro.eztable.com.tw;
    return       301 http://pro.eztable.com$request_uri;
}

server {
    listen       80;
    listen       443 ssl;
    server_name  pro.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/pro.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-pro/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-pro/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-production-mobile
server {
    listen       80;
    listen       443 ssl;
    server_name  m-pro.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/m-pro.eztable.com.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-m-pro/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-m-pro/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-partner
server {
    listen       80;
    server_name  eztable.in;
    return       301 http://partner.eztable.com/control/fbapp/redirect_by_device.php?page_name=$request_uri;
}

server {
    listen       80;
    server_name  partner.eztable.com.tw;
    return       301 http://partner.eztable.com$request_uri;
}

server {
    listen       80;
    listen       443 ssl;
    server_name  partner.eztable.com partner-dev.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/partner.eztable.com.access.log  main;

    # general imgs
    location ~ ^/imgs/(.*)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-imgs/$1;
        expires 30d;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-partner/$1;
        expires 30d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-partner/$1;
        expires 30d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://partner;
    }
}

# ezhungry
server {
    listen       80;
    server_name  www.ezhungey.com.tw;
    return       301 http://shop.eztable.com/;
}

server {
    listen       80;
    server_name  ezhungey.com.tw;
    return       301 http://shop.eztable.com/;
}

server {
    listen       80;
    server_name  www.ezhungey.com;
    return       301 http://shop.eztable.com/;
}

server {
    listen       80;
    server_name  ezhungey.com;
    return       301 http://shop.eztable.com/;
}

# eztable share
server {
    listen       80;
    server_name  share.eztable.com.tw;
    return       301 http://shop.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  share.eztable.com;
    return       301 http://shop.eztable.com$request_uri;
}

# eztable shop
server {
    listen       80;
    listen       443 ssl;
    #server_name  shop.eztable.com shop-dev.eztable.com;
    server_name  shop.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/shop.eztable.com.access.log  main;

    # accounting
    location ~ ^/accounting/(.*)$  {
        return 301 http://widget.eztable.com/accounting/$1;
    }

    # general imgs
    location ~ ^/imgs/(.*)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-imgs/$1;
        expires 30d;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-shop/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-shop/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://webcluster;
    }
}

# eztable-static
server {
    listen       80;
    listen       443 ssl;
    server_name  static.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/static.eztable.com.access.log  main;

    location / {
        proxy_pass http://eztable-static.s3-website-us-east-1.amazonaws.com;
    }
}

# eztable-static-a
server {
    listen       80;
    listen       443 ssl;
    server_name  static-a.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/static-a.eztable.com.access.log  main;

    location / {
        proxy_pass http://eztable-static-a.s3-website-us-east-1.amazonaws.com;
    }
}

# eztable-static-shop
server {
    listen       80;
    listen       443 ssl;
    server_name  static-shop.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/static-shop.eztable.com.access.log  main;

    location / {
        proxy_pass http://eztable-static-shop.s3-website-us-east-1.amazonaws.com;
    }
}

# eztable-static-www
server {
    listen       80;
    listen       443 ssl;
    server_name  static-www.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/static-www.eztable.com.access.log  main;

    location / {
        proxy_pass http://eztable-static-www.s3-website-us-east-1.amazonaws.com;
    }
}

# eztable-thaitown
server {
    listen       80;
    server_name  thaitown.eztable.com.tw;
    return       301 http://ttfb.eztable.com.tw$request_uri;
}

server {
    listen       80;
    server_name  verythai.eztable.com.tw;
    return       301 http://ttfb.eztable.com.tw$request_uri;
}

server {
    listen       80;
    server_name  1010restaurant.eztable.com.tw;
    return       301 http://ttfb.eztable.com.tw$request_uri;
}

server {
    listen       80;
    server_name  ttfb.eztable.com.tw;
    access_log   /var/log/nginx/ttfb.eztable.com.tw.access.log  main;

    # partner files
    location ~ ^/partner_files/(.*)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-thaitown-partner-files/$1;
        expires 3d;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-thaitown/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-thaitown/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://ttfb.eztable.com.tw;
    }
}

# eztable-widget
server {
    listen       80;
    server_name  widget.eztable.com.tw;
    return       301 http://widget.eztable.com$request_uri;
}

server {
    listen       80;
    listen       443 ssl;
    server_name  widget.eztable.com;
    access_log   /var/log/nginx/widget.eztable.com.access.log  main;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    # api
    location ~ ^/v2/(.*)$ {
        include proxy-api.conf;
        proxy_pass      http://web001;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-widget/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-widget/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001;
    }
}

# eztable-www
server {
    listen       80;
    server_name  eztable.com.tw;
    return       301 http://www.eztable.com/;
}

server {
    listen       80;
    server_name  eztable.com;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  eztable.tw;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  www.eztable.tw;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  eztable.org;
    return       301 http://www.eztable.com/;
}

server {
    listen       80;
    server_name  eztable.co;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  www.eztable.co;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  www.eztable.com.tw;
    return       301 http://www.eztable.com$request_uri;
}

server {
    listen       80;
    listen       443 ssl;
    #server_name  www.eztable.com www-dev.eztable.com ru.eztable.com;
    server_name  www.eztable.com ru.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/www.eztable.com.access.log  main;

    client_max_body_size 8M;

    # special events
    location ~ ^/best2013(/?)$ {
        return 301 http://pro.eztable.com/eztable/post/27/?locale=en_US;
    }

    # guarantee
    location ~ ^/guarantee(/?)$ {
        return 301 https://payment.allpay.com.tw/VirtualTrade/SerialNoQuery;
    }

    # deprecated: old partner
    location ~ ^/p/(.*)$  {
        return 301 http://partner.eztable.com/booking.php?page_name=$1;
    }

    # api
    location ~ ^/callback/(.*)$ {
        return 301 https://api.eztable.com$request_uri;
    }
    location ~ ^/wsdl/(.*)$ {
        return 301 https://api.eztable.com$request_uri;
    }

    # old ssl
    location ~ ^/facebook_app/(.*)$ {
        return 301 https://ssl.eztable.com/facebook_app/$1;
    }
    location ~ ^/ipadB(.*)$ {
        return 301 https://ipadconsole.eztable.com/$1;
    }
    location ~ ^/ipadConsole(.*)$ {
        return 301 https://ipadconsole.eztable.com/$1;
    }
    location ~ ^/pcConsole(.*)$ {
        return 301 https://pcconsole.eztable.com/$1;
    }
    location ~ ^/protected/(.*)$ {
        return 301 https://ssl.eztable.com/protected/$1;
    }

    # general imgs
    location ~ ^/imgs/(.*)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-imgs/$1;
        expires 30d;
    }

    # event images
    location ~ ^/event/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-events/$1;
        expires 3d;
    }

    # event css|js
    location ~ ^/event/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-events/$1;
        expires 1d;
    }

    # event
    location ~ ^/event/(.*)?$  {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001/event/$1$is_args$query_string;
    }

    # rest_admin
    location ~ ^/rest_admin/(.*)?$  {
        #limit_req zone=site burst=8;
        #include proxy.conf;
        #proxy_pass      http://10.143.15.238/rest_admin/$1;
        return 301 https://pcconsole.eztable.com;
    }

    location ~ ^/amfphp/(.*)?$  {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://10.143.15.238/amfphp/$1;
    }

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-www/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-www/$1;
        expires 6h;
    }

    # upload
    location ~ ^/control/(upload.*)$  {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://web001/control/$1;
    }

    # ajax
    location /ajax {
        valid_referers none blocked server_names ~(eztable.com);
        if ($invalid_referer) {
            return   403;
        }
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://webcluster;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://webcluster;
    }
}

# eztable-city
server {
    listen       80;
    server_name  city.eztable.com.tw;
    return       301 http://city.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  city.eztable.com;
    access_log   /var/log/nginx/city.eztable.com.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://city.eztable.com.tw;
    }
}

# eztable-food
server {
    listen       80;
    server_name  food.eztable.com.tw;
    return       301 http://food.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  food.eztable.com;
    access_log   /var/log/nginx/food.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://food.eztable.com.tw;
    }
}

# wthefood.com
server {
    listen       80;
    server_name  wthefood.com;
    return       301 http://www.wthefood.com$request_uri;
}

server {
    listen       80;
    server_name  www.wthefood.com;
    access_log   /var/log/nginx/wthefood.com.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://www.wthefood.com;
    }
}

# eztable-school
server {
    listen       80;
    server_name  school.eztable.com.tw;
    return       301 http://school.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  school.eztable.com;
    access_log   /var/log/nginx/school.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://school.eztable.com.tw;
    }
}

# eztable-pic
server {
    listen       80;
    server_name  pic.eztable.com.tw;
    return       301 http://pic.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  pic.eztable.com;
    access_log   /var/log/nginx/pic.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://pic.eztable.com.tw;
    }
}

# eztable-menu
server {
    listen       80;
    server_name  menu.eztable.com.tw;
    return       301 http://menu.eztable.com$request_uri;
}

server {
    listen       80;
    server_name  menu.eztable.com;
    access_log   /var/log/nginx/menu.eztable.com.tw.access.log  main;

    client_max_body_size 8M;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-blogs/$1;
        expires 1d;
    }

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://menu.eztable.com.tw;
    }
}

# eztable-wineclub
server {
    listen       80;
    server_name  wine.eztable.com.tw;
    return       301 http://winentaste.com;
}

server {
    listen       80;
    server_name  wine.eztable.com;
    return       301 http://winentaste.com;
}

# gecko-reporter
server {
    listen       80;
    server_name  gecko-reporter.eztable.com;
    return       301 https://gecko-reporter.eztable.com$request_uri;
}

server {
    listen       443 ssl;
    server_name  gecko-reporter.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/gecko-reporter.eztable.com.access.log  main;

    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://job001:8001;
    }
}

# temp - mikiq
server {
    listen       80;
    server_name  mikiq.com.tw;
    access_log   /var/log/nginx/www.mikiq.com.tw.access.log  main;

    # project images
    location ~ ^/(.*\.(jpg|jpeg|gif|png|ico)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-mikiq/$1;
        expires 3d;
    }

    # project js/css
    location ~ ^/(.*\.(css|js)(\?[^\/]*)?)$  {
        limit_req zone=static burst=880;
        include proxy.conf;
        proxy_pass      http://web001:3939/eztable-mikiq/$1;
        expires 1d;
    }

    # project php
#         location / {
#             limit_req zone=site burst=8;
#             include proxy.conf;
#             proxy_pass      http://mikiq.com.tw;
#         }
}

server {
    listen       443 ssl;
    server_name  windows-app.eztable.com;

    ssl_certificate     /etc/ssl/certs/eztable.com.chained.extension.crt;
    ssl_certificate_key /etc/ssl/private/eztable_wildcard.key;
    #ssl_protocols       SSLv3 TLSv1 TLSv1.1 TLSv1.2;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    #ssl_ciphers RC4:HIGH:!aNULL:!MD5;
    ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;

    access_log   /var/log/nginx/windows-app.eztable.com.access.log  main;

    # project php
    location / {
        limit_req zone=site burst=8;
        include proxy.conf;
        proxy_pass      http://windows-app;
    }
}

